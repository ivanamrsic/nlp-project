//
//  ProfilePresenter.swift
//  SentimentClassifier
//
//  Created by Ivana Mršić on 26.12.2020..
//  Copyright (c) 2020 ___ORGANIZATIONNAME___. All rights reserved.
//
//  This file was generated by the 🐍 VIPER generator
//

import UIKit
import RxSwift
import RxCocoa

final class ProfilePresenter {

    // MARK: - Private properties

    private unowned let view: ProfileViewInterface
    private let interactor: ProfileInteractorInterface
    private let wireframe: ProfileWireframeInterface

    private let disposeBag = DisposeBag()

    // MARK: - Lifecycle

    init(view: ProfileViewInterface, interactor: ProfileInteractorInterface, wireframe: ProfileWireframeInterface) {
        self.view = view
        self.interactor = interactor
        self.wireframe = wireframe
    }
}

// MARK: - ProfilePresenterInterface

extension ProfilePresenter: ProfilePresenterInterface {

    func configure(with output: Profile.ViewOutput) -> Profile.ViewInput {
        handle(choosePhoto: output.choosePhotoAction)
        handle(createReview: output.createReviewAction)

        let items = createItems()

        return Profile.ViewInput(
            items: .just(items),
            image: interactor.profilePhoto,
            reviewCount: .just(items.count)
        )
    }
}

// MARK: - Binding Setup

private extension ProfilePresenter {

    func handle(choosePhoto: Signal<Void>) {
        choosePhoto.emit(onNext: { [unowned wireframe] in
                wireframe.openChoosePhoto()
            })
            .disposed(by: disposeBag)
    }

    func handle(createReview: Signal<Void>) {
        createReview.emit(onNext: { [unowned wireframe] in
                wireframe.openCreateReview()
            })
            .disposed(by: disposeBag)
    }
}

// MARK: - Item creation

private extension ProfilePresenter {

    func createItems() -> [TableCellItem] {
        return [
            ReviewTableCellItem(review: Review.r1),
            ReviewTableCellItem(review: Review.r2),
            ReviewTableCellItem(review: Review.r3),
            ReviewTableCellItem(review: Review.r4)
        ]
    }
}
